var dataTransform={EMC:function(f,g){var g=g/100,e=349+1.29*f+0.0135*Math.pow(f,2),b=0.805+7.36E-4*f-2.73E-6*Math.pow(f,2),c=6.27-0.00938*f-3.03E-4*Math.pow(f,2),a=1.91+0.0407*f-2.93E-4*Math.pow(f,2);return 1800/e*(b*g/(1-b*g)+(c*b*g+2*c*a*Math.pow(b,2)*Math.pow(g,2))/(1+c*b*g+c*a*Math.pow(b,2)*Math.pow(g,2)))},filterCity:function(f){var g=data.cities.filter(function(e){return e.name==f})[0];g.hasOwnProperty("months")||(g.tLimits=[d3.max(g.th),d3.min(g.tl)],g.hLimits=[d3.max(g.hh),d3.min(g.hl)],g.t1Label=
[d3.max(g.th),d3.max(g.tl)],g.t2Label=[d3.min(g.th),d3.min(g.tl)],g.h1Label=[d3.max(g.hh),d3.max(g.hl)],g.h2Label=[d3.min(g.hh),d3.min(g.hl)],g.months=g.th.map(function(e,b){return{t:[g.th[b],g.tl[b]],h:[g.hh[b],g.hl[b]],emc:[dataTransform.EMC(g.tl[b],g.hh[b]),dataTransform.EMC(g.th[b],g.hl[b])]}}),g.emcLimits=[d3.max(g.months,function(e){return e.emc[0]}),d3.min(g.months,function(e){return e.emc[1]})],g.emc1Label=[d3.max(g.months,function(e){return e.emc[0]}),d3.max(g.months,function(e){return e.emc[1]})],
g.emc2Label=[d3.min(g.months,function(e){return e.emc[0]}),d3.min(g.months,function(e){return e.emc[1]})]);return g},calculateVar:function(f,g,e){e||(e=selectedVariation);var b=data.wood.filter(function(c){return c.nomeCientifico==g})[0][e];f.months.forEach(function(c,a){var e=(b*(0+c.emc[1]/30)+b*(0+c.emc[0]/30))/2;c.aMean=e;c.vm=[b*(0+c.emc[0]/30)-e,b*(0+c.emc[1]/30)-e];c.vy=[b*(0+f.emcLimits[0]/30)-e,b*(0+f.emcLimits[1]/30)-e];c.month=monthNames[a];c.abs=[100-b*(1-c.emc[0]/30),100-b*(1-c.emc[1]/
30)]});f.absLabel1=[100-b*(1-f.emc1Label[0]/30),100-b*(1-f.emc1Label[1]/30)];f.absLabel2=[100-b*(1-f.emc2Label[0]/30),100-b*(1-f.emc2Label[1]/30)]},calculateMonthArea:function(f){f.area=d3.sum(f.months.map(function(f){return f.vm[0]-f.vm[1]}))}};var chart1={title:function(f){f=d3.select(f);f.style({height:"auto"});f.append("p").html('Wood <span style="color:red">Relative</span> Dimensional Change').style({"text-align":"left",padding:"0 0 20px",margin:"0px","font-size":"40px"})},titleDescription:function(f){f=d3.select(f);f.style({height:"auto"});f.append("p").html("<strong>How to read</strong>:<br>Each collumn shows the size variation in that month <strong >(black)</strong>, and how much it can grow or shrink during the rest of the year from that month <strong>(gray)</strong>").style({padding:"0 0px 0 0px",
margin:"0px","font-size":"12px","font-style":"italic",color:"red"});f.select("p").transition().delay(5E3).duration(5E3).style({color:"black"})},cityNameLabel:function(f){d3.select(f).text("Cities").classed("v-topRowNameLabel",!0)},selectWoodVarTypeView:function(f){f=d3.select(f);f.append("div").text("Wood Direction").style({"float":"left","margin-right":"10px","pointer-events":"none"}).classed("v-topRowNameLabel",!0);var g=f.selectAll(".v-woodButton").data([{name:"Tangential",type:"varTangencial"},
{name:"Radial",type:"varRadial"}]).enter().append("div").classed("v-woodButton",!0).style({cursor:"pointer"});g.append("p").text(function(e){return e.name}).style({margin:"0px",padding:"0","pointer-events":"none"});g.on("mouseover",function(e){var b=d3.select(this);e.type!=selectedVariation&&b.style({background:"red",color:"white"});chart1.labelVarView.hoverOn(!1,!1,e.type);chart1.varView.removeLabel();chart1.varView.hoverOn(!1,!1,e.type);chart1.condensedView.update(selectedWood,e.type)}).on("mouseout",
function(e){var b=d3.select(this);e.type==selectedVariation?b.style({background:"black",color:"white"}):b.style({background:"white",color:"black"});chart1.labelVarView.hoverOff();chart1.varView.hoverOff();chart1.condensedView.update()}).each(function(e){e.type==selectedVariation&&d3.select(this).style({background:"black",color:"white"}).classed("v-e-selected",!0)}).on("click",function(e){selectedVariation=e.type;data.wood.sort(function(b,c){return+c[selectedVariation]-b[selectedVariation]});chart1.labelVarView.hoverOff();
chart1.varView.removeLabel();chart1.varView.hoverOff();d3.select(chart1.woodView.rawSelection).select("div").remove();chart1.woodView();chart1.condensedView.update();chart1.selectWoodVarTypeView.setSelection();chart2.labelMainView.removeCityHover();chart2.mainView.cityHover(selectedCity);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();d3.select(chart3.woodView.rawSelection).select("div").remove();chart3.woodView();chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();
chart3.condensedView.adjust();chart3.woodView.setSelection();chart3.selectWoodVarTypeView.setSelection()});chart1.selectWoodVarTypeView.setSelection=function(){g.classed("v-e-selected",!1).style({background:"white",color:"black"});g.each(function(e){e.type==selectedVariation&&d3.select(this).style({background:"black",color:"white"})})}},woodNameLabel:function(f){d3.select(f).text("Wood Species").classed("v-topRowNameLabel",!0)},woodView:function(f){f?chart1.woodView.rawSelection=f:f=chart1.woodView.rawSelection;
var g=d3.select(f),e=g.append("div").style({width:"100%",height:"100%",padding:"0px 0px 0 0px"}).selectAll("div").data(data.wood).enter().append("div").style({"border-bottom-style":"solid","border-width":"1px",cursor:"pointer"}).each(function(b){var c=d3.select(this);b.nomeCientifico==selectedWood&&c.classed("v-e-wSelected",!0).style("background","black")}).on("mouseover",function(b){var c=d3.select(this);c.style("background","red");c.select("p").style("color","white").style("font-style","italic").text(function(a){return a.nomeCientifico});
c.each(function(a){var c=d3.select(this);a.nomeCientifico==selectedWood&&c.style("background","black")});chart1.labelVarView.hoverOn(!1,b.nomeCientifico,!1);chart1.varView.removeLabel();chart1.varView.hoverOn(!1,b.nomeCientifico,!1);chart1.condensedView.update(b.nomeCientifico)}).on("mouseout",function(){var b=d3.select(this);b.style("background","white");b.select("p").style("color","black").style("font-style","normal").text(function(c){return c.nomePopular});b.each(function(c){var a=d3.select(this);
c.nomeCientifico==selectedWood&&a.style("background","black").select("p").style("color","white")});chart1.labelVarView.hoverOff();chart1.varView.hoverOff();chart1.condensedView.update(selectedWood)}).on("click",function(b){selectedWood=b.nomeCientifico;chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();chart1.condensedView.setSelection();chart1.woodView.setSelection();chart1.condensedView.update(selectedWood);chart2.labelMainView.removeCityHover();chart2.mainView.cityHover(selectedCity);
chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.adjust();chart3.woodView.setSelection()});e.append("p").style({margin:"0px",padding:"3px 4px","pointer-events":"none"}).text(function(b){return b.nomePopular}).each(function(b){var c=d3.select(this);b.nomeCientifico==selectedWood&&c.style("color","white")});chart1.woodView.setSelection=function(){g.selectAll(".v-e-wSelected, .red").attr("class",
"").style("background","white").select("p").style("color","black");e.each(function(b){b.nomeCientifico==selectedWood&&d3.select(this).attr("class","v-e-wSelected").style("background","black").select("p").style("color","white")})}}};chart1.cityView=function(f){f?chart1.cityView.rawSelection=f:f=chart1.cityView.rawSelection;var g=d3.select(f),e=g.append("div").style({width:"100%",height:"100%",margin:"0px 0px 0 0px",overflow:"auto"}).selectAll("div").data(data.cities).enter().append("div").style({"border-bottom-style":"solid","border-width":"1px",cursor:"pointer"}).each(function(b){var c=d3.select(this);b.name==selectedCity&&c.attr("class","v-e-cSelected").style("background","black").style("color","white")}).on("mouseover",function(b){var c=
d3.select(this);c.style("background","red").style("color","white");b.name==selectedCity&&c.style("background","black").style("color","white").attr("class","v-e-cSelected");chart1.labelVarView.hoverOn(b.name,!1,!1);chart1.varView.removeLabel();chart1.varView.hoverOn(b.name,!1,!1);chart1.condensedView.setSelection(b.name)}).on("mouseout",function(b){var c=d3.select(this);c.style("background","white").style("color","black");b.name==selectedCity&&c.style("background","black").style("color","white").attr("class",
"v-e-cSelected");chart1.labelVarView.hoverOff();chart1.varView.hoverOff();chart1.condensedView.setSelection()}).on("click",function(b){selectedCity=b.name;chart1.cityView.setSelection();chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();chart1.condensedView.setSelection();chart2.labelMainView.removeCityHover();chart2.mainView.cityHover(b.name);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart2.cityView.setSelection();chart3.mainView.hoverInfoOff();
chart3.labelMainView.hoverOff();chart3.condensedView.setSelection();chart3.cityView.setSelection()});e.append("p").style({margin:"0px",padding:"3px 4px","pointer-events":"none"}).text(function(b){return b.name});chart1.cityView.setSelection=function(b){g.selectAll(".v-e-cSelected, .red").attr("class","").style("background","white").style("color","black");e.each(function(c){c.name==b&&d3.select(this).attr("class","red").style("background","red").style("color","white");c.name==selectedCity&&d3.select(this).attr("class",
"v-e-cSelected").style("background","black").style("color","white")})}};chart1.condensedView=function(f){f?chart1.condensedView.rawSelection=f:f=chart1.condensedView.rawSelection;var g=data.cities.map(function(a){return a.name});data.cities.forEach(function(a){dataTransform.calculateVar(a,selectedWood)});var e=d3.select(f),f=parseFloat(e.style("width")),b=parseFloat(e.style("height")),c=d3.scale.linear().domain(chart1Amplitude).range([0,b]),a=d3.scale.ordinal().rangeRoundBands([0,f],0.1,0).domain(g),i=d3.scale.ordinal().rangeBands([0,a.rangeBand()],0.1,0).domain(monthNames);
e.selectAll("svg").data([1]).enter().append("svg").attr("width",f).attr("height",b);var e=e.select("svg"),k=e.selectAll("svg").data(data.cities).enter().append("g").classed("v-e-cityGroup",!0).attr("transform",function(c){return"translate("+a(c.name)+",0)"}).style("cursor","pointer").on("mouseover",function(a){var c=d3.select(this).selectAll(".v-e-monthBlock").attr("fill","red");a.name==selectedCity&&c.attr("fill","black");chart1.cityView.setSelection(a.name);chart1.labelVarView.hoverOn(a.name,!1,
!1);chart1.varView.removeLabel();chart1.varView.hoverOn(a.name,!1,!1)}).on("mouseout",function(a){var c=d3.select(this).selectAll(".v-e-monthBlock").attr("fill","gray");a.name==selectedCity&&c.attr("fill","black");chart1.cityView.setSelection();chart1.labelVarView.hoverOff();chart1.varView.hoverOff()}).on("click",function(a){selectedCity=a.name;chart1.cityView.setSelection();chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();chart1.condensedView.setSelection();chart2.labelMainView.removeCityHover();
chart2.mainView.cityHover(a.name);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart2.cityView.setSelection(a.name);chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.setSelection();chart3.cityView.setSelection(a.name)});k.append("rect").attr({x:0,y:0,width:a.rangeBand(),height:b,fill:"white"});g=k.selectAll("g").data(function(a){return a.months}).enter().append("g").attr("transform",function(a){return"translate("+i(a.month)+",0)"});g.append("rect").classed("v-e-yearBlock",
!0).attr("x",0).attr("y",function(a){return c(a.vy[0])}).attr("fill","lightgray").attr("shape-rendering","crispEdges").attr("width",i.rangeBand()).attr("height",function(a){return c(a.vy[1])-c(a.vy[0])});g.append("rect").classed("v-e-monthBlock",!0).attr("x",0).attr("y",function(a){return c(a.vm[0])}).attr("width",i.rangeBand()).attr("height",function(a){return c(a.vm[1])-c(a.vm[0])}).attr("fill","gray").attr("shape-rendering","crispEdges").attr("pointer-events","none");k.append("line").attr({x1:0,
x2:a.rangeBand(),y1:c(0),y2:c(0),stroke:"white","stroke-width":2,"shape-rendering":"crispEdges"});k.each(function(a){a.name==selectedCity&&d3.select(this).selectAll(".v-e-monthBlock").classed("v-e-black",!0).attr("fill","black")});chart1.condensedView.setSelection=function(a){e.selectAll(".v-e-black, .red, .v-e-monthBlock").attr("class","v-e-monthBlock").attr("fill","gray");k.each(function(c){c.name==a&&d3.select(this).selectAll(".v-e-monthBlock").classed("red",!0).attr("fill","red");c.name==selectedCity&&
d3.select(this).selectAll(".v-e-monthBlock").classed("v-e-black",!0).attr("fill","black")})}};
chart1.condensedView.update=function(f,g){f||(f=selectedWood);g||(g=selectedVariation);data.cities.map(function(a){return a.name});data.cities.forEach(function(a){dataTransform.calculateVar(a,f,g)});var e=d3.select(chart1.condensedView.rawSelection),b=parseFloat(e.style("height")),c=d3.scale.linear().domain(chart1Amplitude).range([0,b]),e=e.selectAll(".v-e-cityGroup").data(data.cities).selectAll("g").data(function(a){return a.months});e.select(".v-e-yearBlock").attr("y",function(a){return c(a.vy[0])}).attr("height",
function(a){return c(a.vy[1])-c(a.vy[0])});e.select(".v-e-monthBlock").attr("y",function(a){return c(a.vm[0])}).attr("height",function(a){return c(a.vm[1])-c(a.vm[0])})};chart1.labelVarView=function(f){f?chart1.labelVarView.rawSelection=f:f=chart1.labelVarView.rawSelection;var g=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(g,selectedWood,selectedVariation);d=g.months[0];var g=d3.select(f),f=d3.select(f),e=parseFloat(f.style("width")),b=parseFloat(f.style("height")),c=d3.scale.linear().domain(chart1Amplitude).range([0,b]);d3.scale.ordinal().rangeRoundBands([0,e],0.02,0).domain(monthNames);f.append("svg").attr("width",e).attr("height",b);f=f.select("svg");
g.style("position","relative");var a=g.append("div").attr("class","v-e-ty").style({position:"absolute",color:"gray","pointer-events":"none"});a.append("p").text("year");var i=a.append("p").text(d3.round(d.vy[0]-d.vy[1],1)+"%");a.selectAll("p").style({margin:0,padding:"1px","text-align":"center",background:"white"});var k=parseFloat(a.style("width")),j=parseFloat(a.style("height"));a.style({top:(c(d.vy[1])+c(d.vy[0]))/2-j/2+"px",left:1*(e/3)-k/2+"px"});var h=f.append("path").classed("v-e-py0",!0).attr({d:"M"+
e+" "+(Math.round(c(d.vy[0]))+0.5)+" L"+1*(e/3)+" "+(Math.round(c(d.vy[0]))+0.5)+" L"+1*(e/3)+" "+(Math.round(c(d.vy[1]))+0.5)+" L"+e+" "+(Math.round(c(d.vy[1]))+0.5)+" ","stroke-width":1,fill:"none",stroke:"gray"}),m=g.append("div").attr("class","v-e-tm").style({position:"absolute",color:"black","pointer-events":"none"});m.append("p").text("month");var l=m.append("p").text(d3.round(d.vm[0]-d.vm[1],1)+"%");m.selectAll("p").style({margin:0,padding:"1px","text-align":"center",background:"white"});var n=
parseFloat(m.style("width")),o=parseFloat(m.style("height"));m.style({top:(c(d.vm[1])+c(d.vm[0]))/2-o/2+"px",left:2*(e/3)-n/2+"px"});var q=f.append("path").classed("v-e-pm0",!0).attr({d:"M"+e+" "+(Math.round(c(d.vm[0]))+0.5)+" L"+2*(e/3)+" "+(Math.round(c(d.vm[0]))+0.5)+" L"+2*(e/3)+" "+(Math.round(c(d.vm[1]))+0.5)+" L"+e+" "+(Math.round(c(d.vm[1]))+0.5)+" ",stroke:"black","stroke-width":1,fill:"none"});chart1.labelVarView.hoverOn=function(b,f,g,p){b||(b=selectedCity);f||(f=selectedWood);g||(g=selectedVariation);
p||(p=0);b=dataTransform.filterCity(b);dataTransform.calculateVar(b,f,g);d=b.months[p];a.style({top:(c(d.vy[1])+c(d.vy[0]))/2-j/2+"px",left:1*(e/3)-k/2+"px",color:"#fd627b"}).transition();i.text(d3.round(d.vy[0]-d.vy[1],1)+"%");h.attr({d:"M"+e+" "+(Math.round(c(d.vy[0]))+0.5)+" L"+1*(e/3)+" "+(Math.round(c(d.vy[0]))+0.5)+" L"+1*(e/3)+" "+(Math.round(c(d.vy[1]))+0.5)+" L"+e+" "+(Math.round(c(d.vy[1]))+0.5)+" ",stroke:"#fd627b"}).transition();m.style({top:(c(d.vm[1])+c(d.vm[0]))/2-o/2+"px",left:2*(e/
3)-n/2+"px",color:"red"}).transition();l.text(d3.round(d.vm[0]-d.vm[1],1)+"%");q.attr({d:"M"+e+" "+(Math.round(c(d.vm[0]))+0.5)+" L"+2*(e/3)+" "+(Math.round(c(d.vm[0]))+0.5)+" L"+2*(e/3)+" "+(Math.round(c(d.vm[1]))+0.5)+" L"+e+" "+(Math.round(c(d.vm[1]))+0.5)+" ",stroke:"red"}).transition()};chart1.labelVarView.hoverOff=function(){var b=selectedWood,f=selectedVariation,g=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(g,b,f);d=g.months[0];a.transition().style({top:(c(d.vy[1])+c(d.vy[0]))/
2-j/2+"px",left:1*(e/3)-k/2+"px",color:"gray"});i.text(d3.round(d.vy[0]-d.vy[1],1)+"%");h.transition().attr({d:"M"+e+" "+(Math.round(c(d.vy[0]))+0.5)+" L"+1*(e/3)+" "+(Math.round(c(d.vy[0]))+0.5)+" L"+1*(e/3)+" "+(Math.round(c(d.vy[1]))+0.5)+" L"+e+" "+(Math.round(c(d.vy[1]))+0.5)+" ",stroke:"gray"});m.transition().style({top:(c(d.vm[1])+c(d.vm[0]))/2-o/2+"px",left:2*(e/3)-n/2+"px",color:"black"});l.text(d3.round(d.vm[0]-d.vm[1],1)+"%");q.transition().attr({d:"M"+e+" "+(Math.round(c(d.vm[0]))+0.5)+
" L"+2*(e/3)+" "+(Math.round(c(d.vm[0]))+0.5)+" L"+2*(e/3)+" "+(Math.round(c(d.vm[1]))+0.5)+" L"+e+" "+(Math.round(c(d.vm[1]))+0.5)+" ",stroke:"black"})}};chart1.varView=function(f){f?chart1.varView.rawSelection=f:f=chart1.varView.rawSelection;var g=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(g,selectedWood);var f=d3.select(f),e=parseFloat(f.style("width")),b=parseFloat(f.style("height")),c=d3.scale.linear().domain(chart1Amplitude).range([0,b]),a=d3.scale.ordinal().rangeBands([0,e],0.08,0).domain(monthNames),f=f.append("svg").attr("width",e).attr("height",b);chart1.varView.xS=a;chart1.varView.yS=c;var i=f.selectAll("g").data(g.months).enter().append("g").attr("transform",
function(c){return"translate("+a(c.month)+",0)"});i.append("rect").classed("v-e-yearBlock",!0).attr("x",0).attr("y",function(a){return c(a.vy[0])}).attr("fill","lightgray").attr("shape-rendering","crispEdges").attr("width",a.rangeBand()/2).attr("height",function(a){return c(a.vy[1])-c(a.vy[0])});i.append("rect").classed("v-e-yearBlock",!0).classed("v-e-yearRed",!0).attr("x",a.rangeBand()/2).attr("y",function(a){return c(a.vy[0])}).attr("fill","lightgray").attr("shape-rendering","crispEdges").attr("width",
a.rangeBand()/2).attr("height",function(a){return c(a.vy[1])-c(a.vy[0])});i.append("rect").classed("v-e-monthBlock",!0).attr("x",0).attr("y",function(a){return c(a.vm[0])}).attr("width",a.rangeBand()/2).attr("height",function(a){return c(a.vm[1])-c(a.vm[0])}).attr("fill","black").attr("shape-rendering","crispEdges").attr("pointer-events","none");i.append("rect").classed("v-e-monthBlock",!0).classed("v-e-monthRed",!0).attr("x",a.rangeBand()/2).attr("y",function(a){return c(a.vm[0])}).attr("width",
a.rangeBand()/2).attr("height",function(a){return c(a.vm[1])-c(a.vm[0])}).attr("fill","black").attr("shape-rendering","crispEdges").attr("pointer-events","none");i.append("line").attr("x1",0).attr("x1",function(){return a.rangeBand()+2}).attr("y1",function(a){return(c(a.vm[1])+c(a.vm[0]))/2}).attr("y2",function(a){return(c(a.vm[1])+c(a.vm[0]))/2}).attr("stroke","white").attr("stroke-width",2).attr("shape-rendering","crispEdges").attr("pointer-events","none");i.append("text").attr({x:a.rangeBand()/
2,y:b-6,"text-anchor":"middle","pointer-events":"none"}).text(function(a){return a.month});i.on("mouseover",function(b,e){var f=d3.select(this),m=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(m,selectedWood);b=m.months[e];i.selectAll(".v-e-label").remove();i.selectAll("text").attr("fill","gray").attr("font-weight","none");f.select("text").attr("fill","red").attr("font-weight","bold");chart1.labelVarView.hoverOn(!1,!1,!1,e);f.select(".v-e-monthRed").attr("fill","red");f.select(".v-e-monthBlock").attr("fill",
"red");f.select(".v-e-yearRed").attr("fill","#ffe2e6");f.select(".v-e-yearBlock").attr("fill","#ffe2e6");f.append("text").attr({x:a.rangeBand()/2,y:function(){return c(b.vm[0])},"text-anchor":"middle",dy:"-.4em","class":"v-e-label","pointer-events":"none","font-size":11,"font-weight":"bold",fill:"red"}).text(function(){return"+"+d3.round(b.vm[0],1)+"%"});f.append("text").attr({x:a.rangeBand()/2,y:function(){return c(b.vm[1])},"text-anchor":"middle",dy:"1em","class":"v-e-label","pointer-events":"none",
"font-size":11,"font-weight":"bold",fill:"red"}).text(function(){return d3.round(b.vm[1],1)+"%"});f.append("text").attr({x:a.rangeBand()/2,y:function(){return c(b.vy[0])},"text-anchor":"middle",dy:"-.4em",fill:function(){return 0.55<b.vy[0]-b.vm[0]?"#fd627b":"none"},"class":"v-e-label","pointer-events":"none","font-size":11}).text(function(){return"+"+d3.round(b.vy[0],1)+"%"});f.append("text").attr({x:a.rangeBand()/2,y:function(){return c(b.vy[1])},"text-anchor":"middle",dy:"1em",fill:function(){return-0.55>
b.vy[1]-b.vm[1]?"#fd627b":"none"},"class":"v-e-label","pointer-events":"none","font-size":11}).text(function(){return d3.round(b.vy[1],1)+"%"})}).on("mouseout",function(){var a=d3.select(this);a.select(".v-e-monthRed").attr("fill","black");a.select(".v-e-monthBlock").attr("fill","black");a.select(".v-e-yearRed").attr("fill","lightgray");a.select(".v-e-yearBlock").attr("fill","lightgray");a.selectAll(".v-e-label").remove().attr("fill","black");chart1.labelVarView.hoverOff();i.selectAll("text").attr("fill",
"gray").attr("font-weight","none")});chart1.varView.hoverOn=function(a,b,e){a||(a=selectedCity);b||(b=selectedWood);e||(e=selectedVariation);a=dataTransform.filterCity(a);dataTransform.calculateVar(a,b,e);i.data(a.months);i.select(".v-e-yearBlock").transition();i.select(".v-e-yearRed").attr("y",function(a){return c(a.vy[0])}).attr("height",function(a){return c(a.vy[1])-c(a.vy[0])}).attr({fill:"#ffe2e6",stroke:"red","stroke-width":1}).transition();i.select(".v-e-monthBlock").transition();i.select(".v-e-monthRed").attr("y",
function(a){return c(a.vm[0])}).attr("height",function(a){return c(a.vm[1])-c(a.vm[0])}).attr("fill","#ff0000").transition()};chart1.varView.hoverOff=function(){var a=selectedWood,b=selectedVariation,e=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(e,a,b);i.data(e.months);i.select(".v-e-yearBlock").transition().attr("y",function(a){return c(a.vy[0])}).attr("height",function(a){return c(a.vy[1])-c(a.vy[0])}).attr("fill","lightgray");i.select(".v-e-yearRed").transition().attr("y",
function(a){return c(a.vy[0])}).attr("height",function(a){return c(a.vy[1])-c(a.vy[0])}).attr({fill:"lightGray",stroke:"none"});i.select(".v-e-monthBlock").transition().attr("y",function(a){return c(a.vm[0])}).attr("height",function(a){return c(a.vm[1])-c(a.vm[0])}).attr("fill","#000000");i.select(".v-e-monthRed").transition().attr("y",function(a){return c(a.vm[0])}).attr("height",function(a){return c(a.vm[1])-c(a.vm[0])}).attr("fill","black").attr("stroke","none")}};
chart1.varView.removeLabel=function(){d3.select(chart1.varView.rawSelection).selectAll(".v-e-label").remove();d3.select(chart1.varView.rawSelection).selectAll("g").selectAll("text").attr("fill","gray").attr("font-weight","none")};var chart2={title:function(f){f=d3.select(f);f.style({height:"auto"});f.append("p").html('<span style="color:red">Temperature</span>, <span style="color:blue">Humidity</span> and <span style="color:gray"> Moisture Content (MC)</span>').style({"text-align":"left",padding:"0 0 20px",margin:"0px","font-size":"40px"})},cityView:function(f){f?chart2.cityView.rawSelection=f:f=chart2.cityView.rawSelection;var g=d3.select(f),e=g.append("div").style({width:"100%",height:"100%",margin:"0px 0px 0 0px",overflow:"auto"}).selectAll("div").data(data.cities).enter().append("div").style({"border-bottom-style":"solid",
"border-width":"1px",cursor:"pointer"}).each(function(b){var c=d3.select(this);b.name==selectedCity&&c.classed("v-e-cSelected",!0).style("background","black").style("color","white")}).on("mouseover",function(b){var c=d3.select(this);c.style("background","gray").style("color","white");c.each(function(a){var b=d3.select(this);a.name==selectedCity&&b.style("background","black")});chart2.labelMainView.cityHover(b.name);chart2.mainView.cityHover(b.name);chart2.condensedView.setSelection(b.name)}).on("mouseout",
function(){var b=d3.select(this);b.style("background","white").style("color","black").style("font-style","normal");b.each(function(b){var a=d3.select(this);b.name==selectedCity&&a.style("background","black").style("color","white")});chart2.labelMainView.removeCityHover();chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection()}).on("click",function(b){selectedCity=b.name;chart1.cityView.setSelection();chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();
chart1.condensedView.setSelection();chart2.labelMainView.removeCityHover();chart2.mainView.cityHover(b.name);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart2.cityView.setSelection(b.name);chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.setSelection();chart3.cityView.setSelection(b.name);g.selectAll(".v-e-cSelected").classed("v-e-cSelected",!1).style("background","white").style("color","black");d3.select(this).classed("v-e-cSelected",
!0).style("background","black").style("color","white")});e.append("p").style({margin:"0px",padding:"3px 4px","pointer-events":"none"}).text(function(b){return b.name});chart2.cityView.setSelection=function(b){g.selectAll(".v-e-cSelected, .gray").attr("class","").style("background","white").style("color","black");e.each(function(c){c.name==b&&d3.select(this).attr("class","gray").style("background","gray").style("color","white");c.name==selectedCity&&d3.select(this).attr("class","v-e-cSelected").style("background",
"black").style("color","white")})}},labelTitle:function(f){d3.select(f).text("Higher and lower months").classed("v-topRowNameLabel",!0)},selectFocusOn:function(f){f=d3.select(f);f.append("div").text("Focus on").style({"float":"left","margin-right":"10px","pointer-events":"none"}).classed("v-topRowNameLabel",!0);var g=f.selectAll(".v-woodButton").data([{name:"Temperature",type:"temp",color:"red"},{name:"Humidity",type:"hum",color:"blue"},{name:"MC",type:"emc",color:"gray"}]).enter().append("div").classed("v-woodButton",
!0).style({cursor:"pointer"});g.append("p").text(function(e){return e.name}).style({margin:"0px",padding:"0","pointer-events":"none"});g.on("mouseover",function(e){var b=d3.select(this);e.type!=focusOn&&b.style({background:function(b){return b.color},color:"white"});chart2.mainView.focusHover(e.type)}).on("mouseout",function(e){var b=d3.select(this);e.type==focusOn?b.style({background:function(b){return b.color},color:"white"}):b.style({background:"white",color:"black"});chart2.mainView.focusOut()}).each(function(e){e.type==
focusOn&&d3.select(this).style({background:function(b){return b.color},color:"white"}).classed("v-e-selected",!0)}).on("click",function(e){focusOn=e.type;chart2.mainView.cityRemoveHover();g.classed("v-e-selected",!1).style({background:"white",color:"black"});d3.select(this).classed("v-e-selected",!0).style({background:function(b){return b.color},color:"white"})})}};chart2.mainView=function(f){f?chart2.mainView.rawSelection=f:f=chart2.mainView.rawSelection;var g=dataTransform.filterCity(selectedCity),e=[10,10,10,0],f=d3.select(f),b=parseFloat(f.style("width")),c=parseFloat(f.style("height")),a=d3.scale.linear().domain(tempAmpl).range([0+e[0],c-e[2]]),i=d3.scale.linear().domain(humAmpl).range([0+e[0],c-e[2]]),k=d3.scale.linear().domain(emcAmpl).range([0+e[0],c-e[2]]),j=d3.scale.ordinal().rangeRoundBands([0+e[3],b-e[1]],0,0).domain(monthNames),f=f.append("svg").attr("width",
b).attr("height",c),h=f.selectAll("g").data(g.months).enter().append("g").attr("transform",function(a){return"translate("+j(a.month)+",0)"});h.append("rect").classed("v-e-tempBlock",!0).attr({x:0*(j.rangeBand()/3),y:function(b){return a(b.t[0])},fill:"red","shape-rendering":"crispEdges",width:j.rangeBand()/3,height:function(b){return a(b.t[1])-a(b.t[0])},opacity:function(){return"temp"==focusOn||"all"==focusOn?1:0.1}});"temp"==focusOn&&(h.append("text").attr({"class":"detailText",x:0*(j.rangeBand()/
3)+j.rangeBand()/6,y:function(b){return a(b.t[0])},fill:"red","text-anchor":"middle",dy:"-.7em","font-size":11}).text(function(a){return d3.round(a.t[0],1)+"\u00ba"}),h.append("text").attr({"class":"detailText",x:0*(j.rangeBand()/3)+j.rangeBand()/6,y:function(b){return a(b.t[1])},fill:"red","text-anchor":"middle",dy:"1.35em","font-size":11}).text(function(a){return d3.round(a.t[1],1)+"\u00ba"}));h.append("rect").classed("v-e-humBlock",!0).attr({x:1*(j.rangeBand()/3),y:function(a){return i(a.h[0])},
fill:"blue","shape-rendering":"crispEdges",width:j.rangeBand()/3,height:function(a){return i(a.h[1])-i(a.h[0])},opacity:function(){return focusOn=="hum"||focusOn=="all"?1:0.1}});"hum"==focusOn&&(h.append("text").attr({"class":"detailText",x:1*(j.rangeBand()/3)+j.rangeBand()/6,y:function(a){return i(a.h[0])},fill:"blue","text-anchor":"middle",dy:"-.7em","font-size":11}).text(function(a){return d3.round(a.h[0],1)+"%"}),h.append("text").attr({"class":"detailText",x:1*(j.rangeBand()/3)+j.rangeBand()/
6,y:function(a){return i(a.h[1])},fill:"blue","text-anchor":"middle",dy:"1.35em","font-size":11}).text(function(a){return d3.round(a.h[1],1)+"%"}));h.append("rect").classed("v-e-emcBlock",!0).attr({x:2*(j.rangeBand()/3),y:function(a){return k(a.emc[0])},fill:"gray","shape-rendering":"crispEdges",width:j.rangeBand()/3,height:function(a){return k(a.emc[1])-k(a.emc[0])},opacity:function(){return focusOn=="emc"||focusOn=="all"?1:0.1}});"emc"==focusOn&&(h.append("text").attr({"class":"detailText",x:2*
(j.rangeBand()/3)+j.rangeBand()/6,y:function(a){return k(a.emc[0])},fill:"gray","text-anchor":"middle",dy:"-.7em","font-size":11}).text(function(a){return d3.round(a.emc[0],1)+"%"}),h.append("text").attr({"class":"detailText",x:2*(j.rangeBand()/3)+j.rangeBand()/6,y:function(a){return k(a.emc[1])},fill:"gray","text-anchor":"middle",dy:"1.35em","font-size":11}).text(function(a){return d3.round(a.emc[1],1)+"%"}));h.append("rect").classed("v-e-tempHover",!0).attr({x:0*(j.rangeBand()/3)+1,y:function(b){return a(b.t[0])},
fill:"none",stroke:"red",width:j.rangeBand()/3-2,height:function(b){return a(b.t[1])-a(b.t[0])},opacity:function(){return focusOn=="temp"||focusOn=="all"?1:0.001},"stroke-width":2});h.append("rect").classed("v-e-humHover",!0).attr({x:1*(j.rangeBand()/3)+1,y:function(a){return i(a.h[0])},fill:"none",stroke:"blue",width:j.rangeBand()/3-2,height:function(a){return i(a.h[1])-i(a.h[0])},opacity:function(){return focusOn=="hum"||focusOn=="all"?1:0.001},"stroke-width":2});h.append("rect").classed("v-e-emcHover",
!0).attr({x:2*(j.rangeBand()/3)+1,y:function(a){return k(a.emc[0])},fill:"none",stroke:"gray",width:j.rangeBand()/3-2,height:function(a){return k(a.emc[1])-k(a.emc[0])},opacity:function(){return focusOn=="emc"||focusOn=="all"?1:0.001},"stroke-width":2});h.append("text").attr({x:j.rangeBand()/2,y:c-6,"text-anchor":"middle","pointer-events":"none",fill:"black","font-weight":"bold"}).text(function(a){return a.month});chart2.mainView.cityHover=function(b){b=dataTransform.filterCity(b);h.data(b.months);
h.selectAll(".detailText").remove();h.select(".v-e-tempHover").attr({y:function(b){return a(b.t[0])},stroke:"red",height:function(b){return a(b.t[1])-a(b.t[0])},opacity:function(){return focusOn=="temp"||focusOn=="all"?1:0.001}}).transition();h.select(".v-e-humHover").attr({y:function(a){return i(a.h[0])},stroke:"blue",height:function(a){return i(a.h[1])-i(a.h[0])},opacity:function(){return focusOn=="hum"||focusOn=="all"?1:0.001}}).transition();h.select(".v-e-emcHover").attr({y:function(a){return k(a.emc[0])},
stroke:"gray",height:function(a){return k(a.emc[1])-k(a.emc[0])},opacity:function(){return focusOn=="emc"||focusOn=="all"?1:0.001}}).transition();h.select(".v-e-tempBlock").attr({opacity:function(){return focusOn=="temp"||focusOn=="all"?0.5:0.1}}).transition();h.select(".v-e-humBlock").attr({opacity:function(){return focusOn=="hum"||focusOn=="all"?0.5:0.1}}).transition();h.select(".v-e-emcBlock").attr({opacity:function(){return focusOn=="emc"||focusOn=="all"?0.5:0.1}}).transition()};chart2.mainView.cityRemoveHover=
function(){g=dataTransform.filterCity(selectedCity);h.data(g.months);h.select(".v-e-tempHover").transition().attr({y:function(b){return a(b.t[0])},stroke:"red",height:function(b){return a(b.t[1])-a(b.t[0])},opacity:function(){return focusOn=="temp"||focusOn=="all"?1:0.001}});h.select(".v-e-humHover").transition().attr({y:function(a){return i(a.h[0])},stroke:"blue",height:function(a){return i(a.h[1])-i(a.h[0])},opacity:function(){return focusOn=="hum"||focusOn=="all"?1:0.001}});h.select(".v-e-emcHover").transition().attr({y:function(a){return k(a.emc[0])},
stroke:"gray",height:function(a){return k(a.emc[1])-k(a.emc[0])},opacity:function(){return focusOn=="emc"||focusOn=="all"?1:0.001}});h.select(".v-e-tempBlock").transition().attr({y:function(b){return a(b.t[0])},height:function(b){return a(b.t[1])-a(b.t[0])}}).transition().delay(300).attr({opacity:function(){return focusOn=="temp"||focusOn=="all"?1:0.1}});h.select(".v-e-humBlock").transition().attr({y:function(a){return i(a.h[0])},height:function(a){return i(a.h[1])-i(a.h[0])}}).transition().delay(300).attr({opacity:function(){return focusOn==
"hum"||focusOn=="all"?1:0.1}});h.select(".v-e-emcBlock").transition().attr({y:function(a){return k(a.emc[0])},height:function(a){return k(a.emc[1])-k(a.emc[0])}}).transition().delay(300).attr({opacity:function(){return focusOn=="emc"||focusOn=="all"?1:0.1}});if(focusOn=="emc"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*2+j.rangeBand()/6,y:function(a){return k(a.emc[0])},fill:"gray","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.emc[0],
1)+"%"}).transition().delay(250).attr("opacity",1);h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*2+j.rangeBand()/6,y:function(a){return k(a.emc[1])},fill:"gray","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.emc[1],1)+"%"}).transition().delay(250).attr("opacity",1)}if(focusOn=="temp"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*0+j.rangeBand()/6,y:function(b){return a(b.t[0])},fill:"red","text-anchor":"middle",
dy:"-.7em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.t[0],1)+"\u00ba"}).transition().delay(250).attr("opacity",1);h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*0+j.rangeBand()/6,y:function(b){return a(b.t[1])},fill:"red","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.t[1],1)+"\u00ba"}).transition().delay(250).attr("opacity",1)}if(focusOn=="hum"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*
1+j.rangeBand()/6,y:function(a){return i(a.h[0])},fill:"blue","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.h[0],1)+"%"}).transition().delay(250).attr("opacity",1);h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*1+j.rangeBand()/6,y:function(a){return i(a.h[1])},fill:"blue","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.h[1],1)+"%"}).transition().delay(250).attr("opacity",1)}};chart2.mainView.focusHover=
function(b){h.selectAll(".detailText").remove();h.select(".v-e-tempHover").attr({y:function(b){return a(b.t[0])},stroke:"red",height:function(b){return a(b.t[1])-a(b.t[0])},opacity:function(){return b=="temp"||b=="all"?1:0.001}}).transition();h.select(".v-e-humHover").attr({y:function(a){return i(a.h[0])},stroke:"blue",height:function(a){return i(a.h[1])-i(a.h[0])},opacity:function(){return b=="hum"||b=="all"?1:0.001}}).transition();h.select(".v-e-emcHover").attr({y:function(a){return k(a.emc[0])},
stroke:"gray",height:function(a){return k(a.emc[1])-k(a.emc[0])},opacity:function(){return b=="emc"||b=="all"?1:0.001}}).transition();h.select(".v-e-tempBlock").attr({y:function(b){return a(b.t[0])},height:function(b){return a(b.t[1])-a(b.t[0])}}).attr({opacity:function(){return b=="temp"||b=="all"?1:0.1}}).transition();h.select(".v-e-humBlock").attr({y:function(a){return i(a.h[0])},height:function(a){return i(a.h[1])-i(a.h[0])}}).attr({opacity:function(){return b=="hum"||b=="all"?1:0.1}}).transition();
h.select(".v-e-emcBlock").attr({y:function(a){return k(a.emc[0])},height:function(a){return k(a.emc[1])-k(a.emc[0])}}).attr({opacity:function(){return b=="emc"||b=="all"?1:0.1}}).transition();if(b=="emc"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*2+j.rangeBand()/6,y:function(a){return k(a.emc[0])},fill:"gray","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.emc[0],1)+"%"}).attr("opacity",1).transition();h.append("text").attr({"class":"detailText",
x:j.rangeBand()/3*2+j.rangeBand()/6,y:function(a){return k(a.emc[1])},fill:"gray","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.emc[1],1)+"%"}).attr("opacity",1).transition()}if(b=="temp"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*0+j.rangeBand()/6,y:function(b){return a(b.t[0])},fill:"red","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.t[0],1)+"\u00ba"}).attr("opacity",1).transition();
h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*0+j.rangeBand()/6,y:function(b){return a(b.t[1])},fill:"red","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.t[1],1)+"\u00ba"}).attr("opacity",1).transition()}if(b=="hum"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*1+j.rangeBand()/6,y:function(a){return i(a.h[0])},fill:"blue","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.h[0],
1)+"%"}).attr("opacity",1).transition();h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*1+j.rangeBand()/6,y:function(a){return i(a.h[1])},fill:"blue","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:0.01}).text(function(a){return d3.round(a.h[1],1)+"%"}).attr("opacity",1).transition()}};chart2.mainView.focusOut=function(){h.selectAll(".detailText").remove();h.select(".v-e-tempHover").transition().attr({y:function(b){return a(b.t[0])},stroke:"red",height:function(b){return a(b.t[1])-
a(b.t[0])},opacity:function(){return focusOn=="temp"||focusOn=="all"?1:0.001}});h.select(".v-e-humHover").transition().attr({y:function(a){return i(a.h[0])},stroke:"blue",height:function(a){return i(a.h[1])-i(a.h[0])},opacity:function(){return focusOn=="hum"||focusOn=="all"?1:0.001}});h.select(".v-e-emcHover").transition().attr({y:function(a){return k(a.emc[0])},stroke:"gray",height:function(a){return k(a.emc[1])-k(a.emc[0])},opacity:function(){return focusOn=="emc"||focusOn=="all"?1:0.001}});h.select(".v-e-tempBlock").transition().attr({y:function(b){return a(b.t[0])},
height:function(b){return a(b.t[1])-a(b.t[0])}}).attr({opacity:function(){return focusOn=="temp"||focusOn=="all"?1:0.1}});h.select(".v-e-humBlock").transition().attr({y:function(a){return i(a.h[0])},height:function(a){return i(a.h[1])-i(a.h[0])}}).attr({opacity:function(){return focusOn=="hum"||focusOn=="all"?1:0.1}});h.select(".v-e-emcBlock").transition().attr({y:function(a){return k(a.emc[0])},height:function(a){return k(a.emc[1])-k(a.emc[0])}}).attr({opacity:function(){return focusOn=="emc"||focusOn==
"all"?1:0.1}});if(focusOn=="emc"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*2+j.rangeBand()/6,y:function(a){return k(a.emc[0])},fill:"gray","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:function(){return focusOn=="emc"?1:0.01}}).text(function(a){return d3.round(a.emc[0],1)+"%"}).transition().delay(0).attr("opacity",1);h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*2+j.rangeBand()/6,y:function(a){return k(a.emc[1])},fill:"gray","text-anchor":"middle",dy:"1.35em",
"font-size":11,opacity:function(){return focusOn=="emc"?1:0.01}}).text(function(a){return d3.round(a.emc[1],1)+"%"}).transition().delay(0).attr("opacity",1)}if(focusOn=="temp"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*0+j.rangeBand()/6,y:function(b){return a(b.t[0])},fill:"red","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:function(){return focusOn=="temp"?1:0.01}}).text(function(a){return d3.round(a.t[0],1)+"\u00ba"}).transition().delay(0).attr("opacity",1);h.append("text").attr({"class":"detailText",
x:j.rangeBand()/3*0+j.rangeBand()/6,y:function(b){return a(b.t[1])},fill:"red","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:function(){return focusOn=="temp"?1:0.01}}).text(function(a){return d3.round(a.t[1],1)+"\u00ba"}).transition().delay(0).attr("opacity",1)}if(focusOn=="hum"){h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*1+j.rangeBand()/6,y:function(a){return i(a.h[0])},fill:"blue","text-anchor":"middle",dy:"-.7em","font-size":11,opacity:function(){return focusOn==
"hum"?1:0.01}}).text(function(a){return d3.round(a.h[0],1)+"%"}).transition().delay(0).attr("opacity",1);h.append("text").attr({"class":"detailText",x:j.rangeBand()/3*1+j.rangeBand()/6,y:function(a){return i(a.h[1])},fill:"blue","text-anchor":"middle",dy:"1.35em","font-size":11,opacity:function(){return focusOn=="hum"?1:0.01}}).text(function(a){return d3.round(a.h[1],1)+"%"}).transition().delay(0).attr("opacity",1)}}};chart2.labelMainView=function(f){f?chart2.labelMainView.rawSelection=f:f=chart2.labelMainView.rawSelection;var g=dataTransform.filterCity(selectedCity),e=[10,0,10,0],b=d3.select(f),c=parseFloat(b.style("width")),a=parseFloat(b.style("height")),i=d3.scale.linear().domain(tempAmpl).range([0+e[0],a-e[2]]),k=d3.scale.linear().domain(humAmpl).range([0+e[0],a-e[2]]),j=d3.scale.linear().domain(emcAmpl).range([0+e[0],a-e[2]]),h=d3.scale.ordinal().rangeRoundBands([0+e[3],c-e[1]],0,0.1).domain(d3.range(3));
b.selectAll("svg").data([1]).enter().append("svg").attr("width",c).attr("height",a);var b=b.select("svg"),m=[{limits1:g.t1Label,limits2:g.t2Label,color:"red",scale:i,format:"\u00ba"},{limits1:g.h1Label,limits2:g.h2Label,color:"blue",scale:k,format:"%"},{limits1:g.emc1Label,limits2:g.emc2Label,color:"gray",scale:j,format:"%"}],l=b.selectAll("g").data(m).enter().append("g").attr("transform",function(a,b){return"translate("+h(b)+",0)"}).each(function(){}),l=b.selectAll("g");l.append("path").attr({d:function(a){return"M"+
(h.rangeBand()/2-2)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-2)+" "+a.scale(a.limits1[1])+" "},stroke:function(a){return a.color},"stroke-width":2,"shape-rendering":"crispEdges",fill:"none",opacity:0,"class":function(){return"oldPath1"}});l.append("path").attr({d:function(a){return"M"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[1])+" "},stroke:function(a){return a.color},"stroke-width":2,"shape-rendering":"crispEdges",fill:"none",opacity:0,"class":function(){return"oldPath2"}}).transition();
d3.range(2).forEach(function(a,b){l.append("text").attr({x:h.rangeBand()/2-4-6,y:function(a){return a.scale(a.limits1[b])},fill:function(a){return a.color},"font-size":12,"font-weight":"bold","text-anchor":"end",dy:".35em","class":function(){return"txtLimit1"+b}}).text(function(a){return Math.round(a.limits1[b])+a.format})});l.append("path").attr({d:function(a){return"M"+(h.rangeBand()/2-4-2)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-2)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-2)+" "+
a.scale(a.limits1[1])+" L"+(h.rangeBand()/2-4-2)+" "+a.scale(a.limits1[1])+" "},stroke:function(a){return a.color},"stroke-width":1,"shape-rendering":"crispEdges",fill:"none","class":function(){return"txtLimit1Path"}});d3.range(2).forEach(function(a,b){l.append("text").attr({x:h.rangeBand()/2+11,y:function(a){return a.scale(a.limits2[b])},fill:function(a){return a.color},"font-size":12,"font-weight":"bold","text-anchor":"start",dy:".35em","class":function(){return"txtLimit2"+b}}).text(function(a){return Math.round(a.limits2[b])+
a.format})});l.append("path").attr({d:function(a){return"M"+(h.rangeBand()/2+6)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[1])+" L"+(h.rangeBand()/2+6)+" "+a.scale(a.limits2[1])+" "},stroke:function(a){return a.color},"stroke-width":1,"shape-rendering":"crispEdges",fill:"none","class":function(){return"txtLimit2Path"}});chart2.labelMainView.cityHover=function(a){f=chart2.labelMainView.rawSelection;a=dataTransform.filterCity(a);
a=[{limits1:a.t1Label,limits2:a.t2Label,color:"red",scale:i,format:"\u00ba"},{limits1:a.h1Label,limits2:a.h2Label,color:"blue",scale:k,format:"%"},{limits1:a.emc1Label,limits2:a.emc2Label,color:"gray",scale:j,format:"%"}];l.select(".oldPath1").attr({d:function(a){return"M"+(h.rangeBand()/2-2)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-2)+" "+a.scale(a.limits1[1])+" "},stroke:function(a){return a.color},"stroke-width":2,"shape-rendering":"crispEdges",fill:"none",opacity:1,"class":function(){return"oldPath1"}}).transition();
l.select(".oldPath2").attr({d:function(a){return"M"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[1])+" "},stroke:function(a){return a.color},"stroke-width":2,"shape-rendering":"crispEdges",fill:"none",opacity:1,"class":function(){return"oldPath2"}}).transition();l.data(a);d3.range(2).forEach(function(a,b){l.each(function(){d3.select(this).select(".txtLimit1"+b).attr({x:h.rangeBand()/2-4-10,y:function(a){return a.scale(a.limits1[b])}}).text(function(a){return Math.round(a.limits1[b])+
a.format}).transition()})});l.select(".txtLimit1Path").attr({d:function(a){return"M"+(h.rangeBand()/2-4-8)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-8)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-8)+" "+a.scale(a.limits1[1])+" L"+(h.rangeBand()/2-4-8)+" "+a.scale(a.limits1[1])+" "}}).transition();d3.range(2).forEach(function(a,b){l.each(function(){d3.select(this).select(".txtLimit2"+b).attr({x:h.rangeBand()/2+15,y:function(a){return a.scale(a.limits2[b])}}).text(function(a){return Math.round(a.limits2[b])+
a.format}).transition()})});l.select(".txtLimit2Path").attr({d:function(a){return"M"+(h.rangeBand()/2+12)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+8)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+8)+" "+a.scale(a.limits2[1])+" L"+(h.rangeBand()/2+12)+" "+a.scale(a.limits2[1])+" "}}).transition()};chart2.labelMainView.removeCityHover=function(){g=dataTransform.filterCity(selectedCity);m=[{limits1:g.t1Label,limits2:g.t2Label,color:"red",scale:i,format:"\u00ba"},{limits1:g.h1Label,limits2:g.h2Label,
color:"blue",scale:k,format:"%"},{limits1:g.emc1Label,limits2:g.emc2Label,color:"gray",scale:j,format:"%"}];l.data(m);l.select(".oldPath1").transition().attr({stroke:"white"});l.select(".oldPath2").transition().attr({stroke:"white"});d3.range(2).forEach(function(a,b){l.each(function(){d3.select(this).select(".txtLimit1"+b).transition().attr({x:h.rangeBand()/2-4-6,y:function(a){return a.scale(a.limits1[b])}}).text(function(a){return Math.round(a.limits1[b])+a.format})})});l.select(".txtLimit1Path").transition().attr({d:function(a){return"M"+
(h.rangeBand()/2-4-2)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-2)+" "+a.scale(a.limits1[0])+" L"+(h.rangeBand()/2-2)+" "+a.scale(a.limits1[1])+" L"+(h.rangeBand()/2-4-2)+" "+a.scale(a.limits1[1])+" "}});d3.range(2).forEach(function(a,b){l.each(function(){d3.select(this).select(".txtLimit2"+b).transition().attr({x:h.rangeBand()/2+11,y:function(a){return a.scale(a.limits2[b])}}).text(function(a){return Math.round(a.limits2[b])+a.format})})});l.select(".txtLimit2Path").transition().attr({d:function(a){return"M"+
(h.rangeBand()/2+6)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[0])+" L"+(h.rangeBand()/2+2)+" "+a.scale(a.limits2[1])+" L"+(h.rangeBand()/2+6)+" "+a.scale(a.limits2[1])+" "}})}};chart2.condensedView=function(f){f?chart2.condensedView.rawSelection=f:f=chart2.condensedView.rawSelection;var g=data.cities.map(function(a){return a.name}),e=[0,0,10,0],b=d3.select(f),c=parseFloat(b.style("width")),f=parseFloat(b.style("height")),a=d3.scale.ordinal().rangeBands([0,c],0.2,0).domain(g),i=d3.scale.ordinal().rangeBands([0,a.rangeBand()],0,0).domain(monthNames),k=d3.scale.linear().domain(tempAmpl).range([0+e[0],f-e[2]]),j=d3.scale.linear().domain(humAmpl).range([0+e[0],f-e[2]]),h=d3.scale.linear().domain(emcAmpl).range([0+
e[0],f-e[2]]);b.selectAll("svg").data([1]).enter().append("svg").attr("width",c).attr("height",f);var b=b.select("svg"),m=b.selectAll("svg").data(data.cities).enter().append("g").classed("v-e-cityGroup",!0).attr("transform",function(b){return"translate("+a(b.name)+",0)"}).style("cursor","pointer").on("mouseover",function(a){var b=d3.select(this).selectAll("circle").attr("fill","gray");a.name==selectedCity&&b.attr("fill","black");chart2.cityView.setSelection(a.name);chart2.labelMainView.cityHover(a.name);
chart2.mainView.cityHover(a.name)}).on("mouseout",function(a){var b=d3.select(this).selectAll("circle").attr("fill","white");a.name==selectedCity&&b.attr("fill","black");chart2.cityView.setSelection();chart2.labelMainView.removeCityHover();chart2.mainView.cityRemoveHover()}).on("click",function(a){selectedCity=a.name;chart1.cityView.setSelection();chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();chart1.condensedView.setSelection();chart2.labelMainView.removeCityHover();
chart2.mainView.cityHover(a.name);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart2.cityView.setSelection(a.name);chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.setSelection();chart3.cityView.setSelection(a.name)});m.append("rect").attr({x:0,y:0,width:a.rangeBand(),height:f,fill:"white"});g=m.selectAll("g").data(function(a){return a.months}).enter().append("g").attr("transform",function(a){return"translate("+i(a.month)+",0)"});g.append("rect").classed("v-e-tempBlock",
!0).attr({x:0*(i.rangeBand()/3),y:function(a){return k(a.t[0])},fill:"red","shape-rendering":"crispEdges",width:i.rangeBand()/3,height:function(a){return k(a.t[1])-k(a.t[0])},opacity:1});g.append("rect").classed("v-e-humBlock",!0).attr({x:1*(i.rangeBand()/3),y:function(a){return j(a.h[0])},fill:"blue","shape-rendering":"crispEdges",width:i.rangeBand()/3,height:function(a){return j(a.h[1])-j(a.h[0])},opacity:1});g.append("rect").classed("v-e-emcBlock",!0).attr({x:2*(i.rangeBand()/3),y:function(a){return h(a.emc[0])},
fill:"gray","shape-rendering":"crispEdges",width:i.rangeBand()/3,height:function(a){return h(a.emc[1])-h(a.emc[0])},opacity:1});m.append("circle").attr({cx:a.rangeBand()/2,cy:f-8,fill:"white",r:4});m.each(function(a){a.name==selectedCity&&d3.select(this).select("circle").attr("fill","black")});chart2.condensedView.setSelection=function(a){m.selectAll("circle").attr("class","").attr("fill","white");m.each(function(b){b.name==a&&d3.select(this).selectAll("circle").classed("gray",!0).attr("fill","gray");
b.name==selectedCity&&d3.select(this).selectAll("circle").classed("black",!0).attr("fill","black")})}};chart3={title:function(f){f=d3.select(f);f.style({height:"auto"});f.append("p").html('Wood <span style="color:green">Absolute</span> Dimensional Change').style({"text-align":"left",padding:"0 0 20px",margin:"0px","font-size":"40px"})},cityNameLabel:function(f){d3.select(f).text("Cities").classed("v-topRowNameLabel",!0)},selectWoodVarTypeView:function(f){f=d3.select(f);f.append("div").text("Wood Direction").style({"float":"left","margin-right":"10px","pointer-events":"none"}).classed("v-topRowNameLabel",
!0);var g=f.selectAll(".v-woodButton").data([{name:"Tangential",type:"varTangencial"},{name:"Radial",type:"varRadial"}]).enter().append("div").classed("v-woodButton",!0).style({cursor:"pointer"});g.append("p").text(function(e){return e.name}).style({margin:"0px",padding:"0","pointer-events":"none"});g.on("mouseover",function(e){var b=d3.select(this);e.type!=selectedVariation&&b.style({background:"green",color:"white"});chart3.mainView.hoverInfoOn(!1,!1,e.type);chart3.labelMainView.hoverOn(!1,!1,e.type);
chart3.condensedView.adjust(!1,e.type)}).on("mouseout",function(e){var b=d3.select(this);e.type==selectedVariation?b.style({background:"black",color:"white"}):b.style({background:"white",color:"black"});chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.adjust()}).each(function(e){e.type==selectedVariation&&d3.select(this).style({background:"black",color:"white"}).classed("v-e-selected",!0)}).on("click",function(e){selectedVariation=e.type;data.wood.sort(function(b,
c){return+c[selectedVariation]-b[selectedVariation]});chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();d3.select(chart1.woodView.rawSelection).select("div").remove();chart1.woodView();chart1.condensedView.update();chart1.selectWoodVarTypeView.setSelection();chart2.labelMainView.removeCityHover();chart2.mainView.cityHover(selectedCity);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();d3.select(chart3.woodView.rawSelection).select("div").remove();
chart3.woodView();chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.adjust();chart3.woodView.setSelection();chart3.selectWoodVarTypeView.setSelection()});chart3.selectWoodVarTypeView.setSelection=function(){g.classed("v-e-selected",!1).style({background:"white",color:"black"});g.each(function(e){e.type==selectedVariation&&d3.select(this).style({background:"black",color:"white"})})}},woodNameLabel:function(f){d3.select(f).text("Wood Species").classed("v-topRowNameLabel",
!0)},woodView:function(f){f?chart3.woodView.rawSelection=f:f=chart3.woodView.rawSelection;var g=d3.select(f),e=g.append("div").style({width:"100%",height:"100%",padding:"0px 0px 0 0px"}).selectAll("div").data(data.wood).enter().append("div").style({"border-bottom-style":"solid","border-width":"1px",cursor:"pointer"}).each(function(b){var c=d3.select(this);b.nomeCientifico==selectedWood&&c.classed("v-e-wSelected",!0).style("background","black")}).on("mouseover",function(b){var c=d3.select(this);c.style("background",
"green");c.select("p").style("color","white").style("font-style","italic").text(function(a){return a.nomeCientifico});c.each(function(a){var b=d3.select(this);a.nomeCientifico==selectedWood&&b.style("background","black")});chart3.mainView.hoverInfoOn(!1,b.nomeCientifico,!1);chart3.labelMainView.hoverOn(!1,b.nomeCientifico,!1);chart3.condensedView.adjust(b.nomeCientifico,!1)}).on("mouseout",function(){var b=d3.select(this);b.style("background","white");b.select("p").style("color","black").style("font-style",
"normal").text(function(b){return b.nomePopular});b.each(function(b){var a=d3.select(this);b.nomeCientifico==selectedWood&&a.style("background","black").select("p").style("color","white")});chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.adjust()}).on("click",function(b){selectedWood=b.nomeCientifico;chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();chart1.condensedView.setSelection();chart1.woodView.setSelection();chart1.condensedView.update(selectedWood);
chart2.labelMainView.removeCityHover();chart2.mainView.cityHover(selectedCity);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.adjust();chart3.woodView.setSelection()});e.append("p").style({margin:"0px",padding:"3px 4px","pointer-events":"none"}).text(function(b){return b.nomePopular}).each(function(b){var c=d3.select(this);b.nomeCientifico==selectedWood&&c.style("color","white")});chart3.woodView.setSelection=
function(){g.selectAll(".v-e-wSelected, .red").attr("class","").style("background","white").select("p").style("color","black");e.each(function(b){b.nomeCientifico==selectedWood&&d3.select(this).attr("class","v-e-wSelected").style("background","black").select("p").style("color","white")})}}};chart3.cityView=function(f){f?chart3.cityView.rawSelection=f:f=chart3.cityView.rawSelection;var g=d3.select(f),e=g.append("div").style({width:"100%",height:"100%",margin:"0px 0px 0 0px",overflow:"auto"}).selectAll("div").data(data.cities).enter().append("div").style({"border-bottom-style":"solid","border-width":"1px",cursor:"pointer"}).each(function(b){var c=d3.select(this);b.name==selectedCity&&c.classed("v-e-cSelected",!0).style("background","black").style("color","white")}).on("mouseover",function(b){var c=
d3.select(this);c.style("background","green").style("color","white");c.each(function(a){var b=d3.select(this);a.name==selectedCity&&b.style("background","black")});chart3.mainView.hoverInfoOn(b.name,!1,!1);chart3.labelMainView.hoverOn(b.name,!1,!1);chart3.condensedView.setSelection(b.name)}).on("mouseout",function(){var b=d3.select(this);b.style("background","white").style("color","black").style("font-style","normal");b.each(function(b){var a=d3.select(this);b.name==selectedCity&&a.style("background",
"black").style("color","white")});chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.setSelection()}).on("click",function(b){selectedCity=b.name;chart1.cityView.setSelection();chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();chart1.condensedView.setSelection();chart2.labelMainView.removeCityHover();chart2.mainView.cityHover(b.name);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart2.cityView.setSelection(b.name);
chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.setSelection();chart3.cityView.setSelection(b.name);g.selectAll(".v-e-cSelected").attr("class","").style("background","white").style("color","black");d3.select(this).attr("class","v-e-cSelected").style("background","black").style("color","white")});e.append("p").style({margin:"0px",padding:"3px 4px","pointer-events":"none"}).text(function(b){return b.name});chart3.cityView.setSelection=function(b){g.selectAll(".v-e-cSelected, .green").attr("class",
"").style("background","white").style("color","black");e.each(function(c){c.name==b&&d3.select(this).attr("class","green").style("background","green").style("color","white");c.name==selectedCity&&d3.select(this).attr("class","v-e-cSelected").style("background","black").style("color","white")})}};chart3.mainView=function(f){f?chart3.mainView.rawSelection=f:f=chart3.mainView.rawSelection;var g=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(g,selectedWood);var f=d3.select(f),e=parseFloat(f.style("width")),b=parseFloat(f.style("height")),c=d3.scale.linear().domain(chart3Amplitude).range([0,b]),a=d3.scale.ordinal().rangeRoundBands([0,e],0.02,0).domain(monthNames),f=f.append("svg").attr("width",e).attr("height",b),i=f.selectAll("g").data(g.months).enter().append("g").attr("transform",
function(b){return"translate("+a(b.month)+",0)"});i.each(function(c,e){0==e%2&&d3.select(this).append("rect").attr({x:0,y:0,width:a.rangeBand(),height:b,fill:"#f4f4f4"})});f.append("line").attr({x1:0,x2:e,y1:c(100),y2:c(100),stroke:"green","stroke-width":3,"shape-rendering":"crispEdges"});i.append("text").text(function(a){return d3.round(a.abs[0],1)+"%"}).attr({x:a.rangeBand()-6,y:function(a){var b=c(a.abs[1])-c(a.abs[0]);return 10>b?c(a.abs[0])-(10-b)/2:c(a.abs[0])},fill:"black","font-size":10,"font-weight":"bold",
dy:".35em","text-anchor":"end","class":"text1"});i.append("text").text(function(a){return d3.round(a.abs[1],1)+"%"}).attr({x:a.rangeBand()-6,y:function(a){var b=c(a.abs[1])-c(a.abs[0]);return 10>b?c(a.abs[1])+(10-b)/2:c(a.abs[1])},fill:"black","font-size":10,"font-weight":"bold",dy:".35em","text-anchor":"end","class":"text2"});i.append("path").attr({d:function(b){return"M"+a.rangeBand()+" "+c(b.abs[0])+" L"+a.rangeBand()+" "+c(b.abs[1])+" "},stroke:"black","stroke-width":1,"shape-rendering":"crispEdges",
fill:"none","class":"line"});i.append("path").attr({d:function(b){return"M"+(a.rangeBand()-4)+" "+c(b.abs[0])+" L"+a.rangeBand()+" "+c(b.abs[0])+" L"+a.rangeBand()+" "+c(b.abs[1])+" L"+(a.rangeBand()-4)+" "+c(b.abs[1])+" "},stroke:"black","stroke-width":1,"shape-rendering":"crispEdges",fill:"none","class":"colchete"});i.append("text").attr({x:a.rangeBand()/2,y:b-6,"text-anchor":"middle","pointer-events":"none",fill:"black","font-size":12,"font-weight":"bold"}).text(function(a){return a.month});i.on("mouseover",
function(){d3.select(this);var a=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(a,selectedWood)}).on("mouseout",function(){d3.select(this)});chart3.mainView.hoverInfoOn=function(b,e,f){b||(b=selectedCity);e||(e=selectedWood);f||(f=selectedVariation);b=dataTransform.filterCity(b);dataTransform.calculateVar(b,e,f);i.data(b.months).select(".text1").text(function(a){return d3.round(a.abs[0],1)+"%"}).attr({x:a.rangeBand()-8,y:function(a){var b=c(a.abs[1])-c(a.abs[0]);return 10>b?c(a.abs[0])-
(10-b)/2:c(a.abs[0])},fill:"green"}).transition();i.data(b.months).select(".text2").text(function(a){return d3.round(a.abs[1],1)+"%"}).attr({x:a.rangeBand()-8,y:function(a){var b=c(a.abs[1])-c(a.abs[0]);return 10>b?c(a.abs[1])+(10-b)/2:c(a.abs[1])},fill:"green"}).transition();i.select(".line").transition();i.select(".colchete").attr({d:function(b){return"M"+(a.rangeBand()-4-2.5)+" "+c(b.abs[0])+" L"+(a.rangeBand()-2.5)+" "+c(b.abs[0])+" L"+(a.rangeBand()-2.5)+" "+c(b.abs[1])+" L"+(a.rangeBand()-4-
2.5)+" "+c(b.abs[1])+" "},stroke:"green"}).transition()};chart3.mainView.hoverInfoOff=function(){var b=dataTransform.filterCity(selectedCity);dataTransform.calculateVar(b,selectedWood,selectedVariation);i.data(b.months);i.select(".text1").transition().text(function(a){return d3.round(a.abs[0],1)+"%"}).attr({x:a.rangeBand()-6,y:function(a){var b=c(a.abs[1])-c(a.abs[0]);return 10>b?c(a.abs[0])-(10-b)/2:c(a.abs[0])},fill:"black"});i.select(".text2").transition().text(function(a){return d3.round(a.abs[1],
1)+"%"}).attr({x:a.rangeBand()-6,y:function(a){var b=c(a.abs[1])-c(a.abs[0]);return 10>b?c(a.abs[1])+(10-b)/2:c(a.abs[1])},fill:"black"});i.select(".line").transition().attr({d:function(b){return"M"+a.rangeBand()+" "+c(b.abs[0])+" L"+a.rangeBand()+" "+c(b.abs[1])+" "}});i.select(".colchete").transition().attr({d:function(b){return"M"+(a.rangeBand()-4)+" "+c(b.abs[0])+" L"+a.rangeBand()+" "+c(b.abs[0])+" L"+a.rangeBand()+" "+c(b.abs[1])+" L"+(a.rangeBand()-4)+" "+c(b.abs[1])+" "},stroke:"black"})}};chart3.labelMainView=function(f){f?chart3.labelMainView.rawSelection=f:f=chart3.labelMainView.rawSelection;var g=dataTransform.filterCity(selectedCity),e=d3.select(f),b=parseFloat(e.style("width")),c=parseFloat(e.style("height")),e=d3.select(f),b=parseFloat(e.style("width")),c=parseFloat(e.style("height")),a=d3.scale.linear().domain(chart3Amplitude).range([0,c]),e=e.append("svg").attr("width",b).attr("height",c);e.append("text").text("Green Wood").attr({x:b/2,y:a(100),"text-anchor":"middle",dy:"-.3em",
fill:"green","font-weight":"bold","font-size":12,"class":"green"});e.append("text").text("100%").attr({x:b/2,y:a(100),"text-anchor":"middle",dy:"+1em",fill:"green","font-weight":"bold","font-size":12,"class":"green"});e.append("text").attr({x:b/2-4-6-2,y:(a(g.absLabel1[1])+a(g.absLabel1[0]))/2,fill:function(){return 30<a(g.absLabel1[1])-a(g.absLabel1[0])?"gray":"white"},"font-size":10,"font-weight":"bold","text-anchor":"end",dy:".35em","font-size":10,"class":"higher"}).text("higher");e.append("text").attr({x:b/
2-4-6,y:function(){var b=a(g.absLabel1[1])-a(g.absLabel1[0]);return 10>b?a(g.absLabel1[0])-(10-b)/2:a(g.absLabel1[0])},fill:"gray","font-size":10,"font-weight":"bold","text-anchor":"end",dy:".35em","font-size":10,"class":"l1-text1"}).text(function(){return d3.round(g.absLabel1[0],1)+"%"});e.append("text").attr({x:b/2-4-6,y:function(){var b=a(g.absLabel1[1])-a(g.absLabel1[0]);return 10>b?a(g.absLabel1[1])+(10-b)/2:a(g.absLabel1[1])},fill:"gray","font-size":10,"font-weight":"bold","text-anchor":"end",
dy:".35em","font-size":10,"class":"l1-text2"}).text(function(){return d3.round(g.absLabel1[1],1)+"%"});e.append("path").attr({d:function(){return"M"+(b/2-2)+" "+a(g.absLabel1[0])+" L"+(b/2-2)+" "+a(g.absLabel1[1])+" "},stroke:"gray","stroke-width":2,"shape-rendering":"crispEdges",fill:"none","class":"l1-line"});e.append("path").attr({d:function(){return"M"+(b/2-4-2)+" "+a(g.absLabel1[0])+" L"+(b/2-2)+" "+a(g.absLabel1[0])+" L"+(b/2-2)+" "+a(g.absLabel1[1])+" L"+(b/2-4-2)+" "+a(g.absLabel1[1])+" "},
stroke:"gray","stroke-width":1,"shape-rendering":"crispEdges",fill:"none","class":"l1-path"});e.append("text").attr({x:b/2+11,y:(a(g.absLabel2[1])+a(g.absLabel2[0]))/2,fill:function(){return 30<a(g.absLabel2[1])-a(g.absLabel2[0])?"gray":"white"},"font-size":10,"font-weight":"bold","text-anchor":"start",dy:".35em","font-size":10,"class":"lower"}).text("lower");e.append("text").attr({x:b/2+11,y:function(){var b=a(g.absLabel2[1])-a(g.absLabel2[0]);return 10>b?a(g.absLabel2[0])-(10-b)/2:a(g.absLabel2[0])},
fill:"gray","font-size":10,"font-weight":"bold","text-anchor":"start",dy:".35em","font-size":10,"class":"l2-txt1"}).text(function(){return d3.round(g.absLabel2[0],1)+"%"});e.append("text").attr({x:b/2+11,y:function(){var b=a(g.absLabel2[1])-a(g.absLabel2[0]);return 10>b?a(g.absLabel2[1])+(10-b)/2:a(g.absLabel2[1])},fill:"gray","font-size":10,"font-weight":"bold","text-anchor":"start",dy:".35em","font-size":10,"class":"l2-txt2"}).text(function(){return d3.round(g.absLabel2[1],1)+"%"});e.append("path").attr({d:function(){return"M"+
(b/2+2)+" "+a(g.absLabel2[0])+" L"+(b/2+2)+" "+a(g.absLabel2[1])+" "},stroke:"gray","stroke-width":2,"shape-rendering":"crispEdges",fill:"none","class":"l2-line"});e.append("path").attr({d:function(){return"M"+(b/2+6)+" "+a(g.absLabel2[0])+" L"+(b/2+2)+" "+a(g.absLabel2[0])+" L"+(b/2+2)+" "+a(g.absLabel2[1])+" L"+(b/2+6)+" "+a(g.absLabel2[1])+" "},stroke:"gray","stroke-width":1,"shape-rendering":"crispEdges",fill:"none","class":"l2-path"});chart3.labelMainView.hoverOn=function(c,f,g){c||(c=selectedCity);
f||(f=selectedWood);g||(g=selectedVariation);var h=dataTransform.filterCity(c);dataTransform.calculateVar(h,f,g);e.selectAll(".green").attr({fill:function(){return 16<a(h.absLabel1[0])-a(100)?"green":"white"}}).transition();e.select(".l1-text1").attr({x:b/2-4-11,y:function(){var b=a(h.absLabel1[1])-a(h.absLabel1[0]);return 10>b?a(h.absLabel1[0])-(10-b)/2:a(h.absLabel1[0])},fill:"gray"}).text(function(){return d3.round(h.absLabel1[0],1)+"%"}).transition();e.select(".l1-text2").attr({x:b/2-4-11,y:function(){var b=
a(h.absLabel1[1])-a(h.absLabel1[0]);return 10>b?a(h.absLabel1[1])+(10-b)/2:a(h.absLabel1[1])}}).text(function(){return d3.round(h.absLabel1[1],1)+"%"}).transition();e.select(".higher").attr({x:b/2-4-11-2,y:(a(h.absLabel1[1])+a(h.absLabel1[0]))/2,fill:function(){return 30<a(h.absLabel1[1])-a(h.absLabel1[0])?"gray":"white"}}).text("higher").transition();e.select(".l1-line").transition();e.select(".l1-path").attr({d:function(){return"M"+(b/2-4-7.5)+" "+a(h.absLabel1[0])+" L"+(b/2-7.5)+" "+a(h.absLabel1[0])+
" L"+(b/2-7.5)+" "+a(h.absLabel1[1])+" L"+(b/2-4-7.5)+" "+a(h.absLabel1[1])+" "}}).transition();e.select(".l2-txt1").attr({x:b/2+16,y:function(){var b=a(h.absLabel2[1])-a(h.absLabel2[0]);return 10>b?a(h.absLabel2[0])-(10-b)/2:a(h.absLabel2[0])}}).text(function(){return d3.round(h.absLabel2[0],1)+"%"}).transition();e.select(".l2-txt2").attr({x:b/2+16,y:function(){var b=a(h.absLabel2[1])-a(h.absLabel2[0]);return 10>b?a(h.absLabel2[1])+(10-b)/2:a(h.absLabel2[1])}}).text(function(){return d3.round(h.absLabel2[1],
1)+"%"}).transition();e.select(".lower").attr({x:b/2+16,y:(a(h.absLabel2[1])+a(h.absLabel2[0]))/2,fill:function(){return 30<a(h.absLabel2[1])-a(h.absLabel2[0])?"gray":"white"}}).text("lower").transition();e.select(".l2-line").transition();e.select(".l2-path").attr({d:"M"+(b/2+11.5)+" "+a(h.absLabel2[0])+" L"+(b/2+7.5)+" "+a(h.absLabel2[0])+" L"+(b/2+7.5)+" "+a(h.absLabel2[1])+" L"+(b/2+11.5)+" "+a(h.absLabel2[1])+" "}).transition()};chart3.labelMainView.hoverOff=function(){var c=dataTransform.filterCity(selectedCity);
dataTransform.calculateVar(c,selectedWood,selectedVariation);e.selectAll(".green").transition().attr({fill:function(){return 16<a(c.absLabel1[0])-a(100)?"green":"white"}});e.select(".l1-text1").transition().attr({x:b/2-4-6,y:function(){var b=a(c.absLabel1[1])-a(c.absLabel1[0]);return 10>b?a(c.absLabel1[0])-(10-b)/2:a(c.absLabel1[0])},fill:"gray"}).text(function(){return d3.round(c.absLabel1[0],1)+"%"});e.select(".l1-text2").transition().attr({x:b/2-4-6,y:function(){var b=a(c.absLabel1[1])-a(c.absLabel1[0]);
return 10>b?a(c.absLabel1[1])+(10-b)/2:a(c.absLabel1[1])}}).text(function(){return d3.round(c.absLabel1[1],1)+"%"});e.select(".higher").transition().attr({x:b/2-4-6-2,y:(a(c.absLabel1[1])+a(c.absLabel1[0]))/2,fill:function(){return 30<a(c.absLabel1[1])-a(c.absLabel1[0])?"gray":"white"}}).text("higher");e.select(".l1-line").transition().attr({d:function(){return"M"+(b/2-2)+" "+a(c.absLabel1[0])+" L"+(b/2-2)+" "+a(c.absLabel1[1])+" "}});e.select(".l1-path").transition().attr({d:function(){return"M"+
(b/2-4-2)+" "+a(c.absLabel1[0])+" L"+(b/2-2)+" "+a(c.absLabel1[0])+" L"+(b/2-2)+" "+a(c.absLabel1[1])+" L"+(b/2-4-2)+" "+a(c.absLabel1[1])+" "}});e.select(".l2-txt1").transition().attr({x:b/2+11,y:function(){var b=a(c.absLabel2[1])-a(c.absLabel2[0]);return 10>b?a(c.absLabel2[0])-(10-b)/2:a(c.absLabel2[0])}}).text(function(){return d3.round(c.absLabel2[0],1)+"%"});e.select(".l2-txt2").transition().attr({x:b/2+11,y:function(){var b=a(c.absLabel2[1])-a(c.absLabel2[0]);return 10>b?a(c.absLabel2[1])+(10-
b)/2:a(c.absLabel2[1])}}).text(function(){return d3.round(c.absLabel2[1],1)+"%"});e.select(".lower").transition().attr({x:b/2+11,y:(a(c.absLabel2[1])+a(c.absLabel2[0]))/2,fill:function(){return 30<a(c.absLabel2[1])-a(c.absLabel2[0])?"gray":"white"}}).text("lower");e.select(".l2-line").transition().attr({d:"M"+(b/2+2)+" "+a(c.absLabel2[0])+" L"+(b/2+2)+" "+a(c.absLabel2[1])+" "});e.select(".l2-path").transition().attr({d:"M"+(b/2+6)+" "+a(c.absLabel2[0])+" L"+(b/2+2)+" "+a(c.absLabel2[0])+" L"+(b/
2+2)+" "+a(c.absLabel2[1])+" L"+(b/2+6)+" "+a(c.absLabel2[1])+" "})}};chart3.condensedView=function(f){f?chart3.condensedView.rawSelection=f:f=chart3.condensedView.rawSelection;var g=data.cities.map(function(a){return a.name});data.cities.forEach(function(a){dataTransform.calculateVar(a,selectedWood)});var e=d3.select(f),f=parseFloat(e.style("width")),b=parseFloat(e.style("height")),c=d3.scale.linear().domain(chart3Amplitude).range([0,b]),a=d3.scale.ordinal().rangeRoundBands([0,f],0.1,0).domain(g),i=d3.scale.ordinal().rangeRoundBands([0,a.rangeBand()],0.3,0).domain(monthNames);
e.selectAll("svg").data([1]).enter().append("svg").attr("width",f).attr("height",b);var e=e.select("svg"),k=e.selectAll("g").data(data.cities).enter().append("g").classed("v-e-cityGroup",!0).attr("transform",function(b){return"translate("+a(b.name)+",0)"}).style("cursor","pointer").on("mouseover",function(a){var b=d3.select(this).selectAll(".v-e-monthBlock").attr("fill","green");a.name==selectedCity&&b.attr("fill","black");chart3.mainView.hoverInfoOn(a.name,!1,!1);chart3.labelMainView.hoverOn(a.name,
!1,!1);chart3.cityView.setSelection(a.name)}).on("mouseout",function(a){var b=d3.select(this).selectAll(".v-e-monthBlock").attr("fill","gray");a.name==selectedCity&&b.attr("fill","black");chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.cityView.setSelection()}).on("click",function(a){selectedCity=a.name;chart1.cityView.setSelection();chart1.labelVarView.hoverOff();chart1.varView.removeLabel();chart1.varView.hoverOff();chart1.condensedView.setSelection();chart2.labelMainView.removeCityHover();
chart2.mainView.cityHover(a.name);chart2.mainView.cityRemoveHover();chart2.condensedView.setSelection();chart2.cityView.setSelection(a.name);chart3.mainView.hoverInfoOff();chart3.labelMainView.hoverOff();chart3.condensedView.setSelection();chart3.cityView.setSelection(a.name)});k.append("rect").attr({x:0,y:0,width:a.rangeBand(),height:b,fill:"white"});g=k.selectAll("g").data(function(a){return a.months}).enter().append("g").attr("transform",function(a){return"translate("+i(a.month)+",0)"});g.each(function(a,
c){0==c%2&&d3.select(this).append("rect").attr({x:0,y:0,width:i.rangeBand(),height:b,fill:"#f4f4f4"})});k.append("line").attr({x1:0,x2:a.rangeBand(),y1:c(100),y2:c(100),stroke:"green","stroke-width":2,"shape-rendering":"crispEdges"});g.append("rect").classed("v-e-monthBlock",!0).attr("x",0).attr("y",function(a){return c(a.abs[0])}).attr("width",i.rangeBand()).attr("height",function(a){return c(a.abs[1])-c(a.abs[0])}).attr("fill","gray").attr("shape-rendering","crispEdges");k.each(function(a){a.name==
selectedCity&&d3.select(this).selectAll(".v-e-monthBlock").classed("v-e-black",!0).attr("fill","black")});chart3.condensedView.adjust=function(a,b){a||(a=selectedWood);b||(b=selectedVariation);data.cities.forEach(function(c){dataTransform.calculateVar(c,a,b)});k.data(data.cities).selectAll(".v-e-monthBlock").data(function(a){return a.months}).attr("y",function(a){return c(a.abs[0])}).attr("height",function(a){return c(a.abs[1])-c(a.abs[0])})};chart3.condensedView.setSelection=function(a){e.selectAll(".v-e-black, .green, .v-e-monthBlock").attr("class",
"v-e-monthBlock").attr("fill","gray");k.each(function(b){b.name==a&&d3.select(this).selectAll(".v-e-monthBlock").classed("green",!0).attr("fill","green");b.name==selectedCity&&d3.select(this).selectAll(".v-e-monthBlock").classed("v-e-black",!0).attr("fill","black")})}};var data,containerW=1E3,monthNames="JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC".split(" "),selectedWood="Pouteria pachycarpa",selectedCity="Curitiba",selectedVariation="varTangencial",chart1Amplitude=[5.7,-5.7],chart3Amplitude=[101,89],tempAmpl=[35,-14],humAmpl=[100,0],emcAmpl=[30,3],focusOn="emc",layoutData=[{section:"chart1",child:[{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,200],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0]},{"class":"v-cell",flex:0.8,padding:[0,5,0,0]},
{"class":"v-cell",flex:3.2,padding:[20,30,0,5],funCall:chart1.title},{"class":"v-cell",flex:1,padding:[30,0,0,0],funCall:"chart1.titleDescription"}]},{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,25],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart1.cityNameLabel},{"class":"v-cell",flex:0.8,padding:[0,5,0,0]},{"class":"v-cell",flex:3.2,padding:[0,30,0,5],funCall:chart1.selectWoodVarTypeView},{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart1.woodNameLabel}]},{"class":"v-row",
padding:[0,14,0,14],rect:[0,0,containerW,400],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart1.cityView},{"class":"v-cell",flex:0.8,padding:[0,5,0,0],funCall:chart1.labelVarView},{"class":"v-cell",flex:3.2,padding:[0,30,0,0],funCall:chart1.varView},{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart1.woodView}]},{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,150],child:[{"class":"v-cell",flex:1,padding:[20,0,0,0],funCall:chart1.condensedView}]}]},{section:"chart2",
child:[{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,240],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0]},{"class":"v-cell",flex:1.8,padding:[0,5,0,0]},{"class":"v-cell",flex:3.2,padding:[20,30,10,5],funCall:chart2.title}]},{"class":"v-row",padding:[0,14,20,14],rect:[0,0,containerW,25],child:[{"class":"v-cell",flex:1,padding:[5,0,0,0],funCall:chart1.cityNameLabel},{"class":"v-cell",flex:1.8,padding:[5,0,0,15],funCall:chart2.labelTitle},{"class":"v-cell",flex:3.2,padding:[0,0,0,0],funCall:chart2.selectFocusOn}]},
{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,400],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart2.cityView},{"class":"v-cell",flex:1.8,padding:[0,0,0,0],funCall:chart2.labelMainView},{"class":"v-cell",flex:3.2,padding:[0,0,0,0],funCall:chart2.mainView}]},{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,150],child:[{"class":"v-cell",flex:1,padding:[20,0,0,0],funCall:chart2.condensedView}]}]},{section:"chart3",child:[{"class":"v-row",padding:[0,14,0,14],rect:[0,
0,containerW,200],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0]},{"class":"v-cell",flex:0.8,padding:[0,5,0,0]},{"class":"v-cell",flex:3.2,padding:[20,30,0,5],funCall:chart3.title},{"class":"v-cell",flex:1,padding:[30,0,0,0],funCall:"chart1.titleDescription"}]},{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,25],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart3.cityNameLabel},{"class":"v-cell",flex:0.8,padding:[0,5,0,0]},{"class":"v-cell",flex:3.2,padding:[0,30,0,5],funCall:chart3.selectWoodVarTypeView},
{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart3.woodNameLabel}]},{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,400],child:[{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart3.cityView},{"class":"v-cell",flex:0.8,padding:[0,5,0,0],funCall:chart3.labelMainView},{"class":"v-cell",flex:3.2,padding:[0,30,0,0],funCall:chart3.mainView},{"class":"v-cell",flex:1,padding:[0,0,0,0],funCall:chart3.woodView}]},{"class":"v-row",padding:[0,14,0,14],rect:[0,0,containerW,150],child:[{"class":"v-cell",
flex:1,padding:[20,0,0,0],funCall:chart3.condensedView}]}]}];
function layout(f){function g(e){var b=d3.select(this);if(e.hasOwnProperty("child")&&0<e.child.length){var c=d3.sum(e.child,function(a){return a.flex}),a=d3.scale.linear().domain([0,c]).range([0,parseFloat(b.style("width"))]),e=b.selectAll("div").data(e.child).enter().append("div");0==c?e.attr("class",function(a){return a["class"]}).style({width:function(a){return a.rect[2]-a.padding[1]-a.padding[3]+"px"},height:function(a){return a.rect[3]-a.padding[0]-a.padding[2]+"px"},padding:function(a){return a.padding[0]+
"px "+a.padding[1]+"px "+a.padding[2]+"px "+a.padding[3]+"px"},margin:"0 auto 0"}).each(g):e.attr("class",function(a){return a["class"]}).style({width:function(b){return a(b.flex)-b.padding[1]-b.padding[3]+"px"},height:function(a){return parseFloat(b.style("height"))-a.padding[0]-a.padding[2]+"px"},padding:function(a){return a.padding[0]+"px "+a.padding[1]+"px "+a.padding[2]+"px "+a.padding[3]+"px"},"float":"left"}).each(function(a){a.hasOwnProperty("funCall")&&"function"===typeof a.funCall&&a.funCall(this)}).each(g)}}
f.forEach(function(e){d3.select("#"+e.section).datum(e).each(g)})};